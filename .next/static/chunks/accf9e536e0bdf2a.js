(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99284,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(86201),a=e.i(46696),l=e.i(18566),n=e.i(79802);function o({warehouses:e}){let r=(0,l.useRouter)(),[o,i]=(0,s.useState)(!1),d=async e=>{e.preventDefault(),i(!0);let t=new FormData(e.currentTarget);try{let s=await (0,n.createInventoryItem)(t);s.success?(a.toast.success(s.message),r.refresh(),e.target.reset()):a.toast.error(s.message)}catch{a.toast.error("Failed to add item")}finally{i(!1)}};return(0,t.jsxs)("form",{onSubmit:d,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Item Name (English)"}),(0,t.jsx)("input",{type:"text",name:"nameEn",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",placeholder:"e.g. Safety Helmet"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Item Name (Arabic)"}),(0,t.jsx)("input",{type:"text",name:"nameAr",className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-right",placeholder:"مثال: خوذة سلامة"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Category"}),(0,t.jsxs)("select",{name:"category",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",children:[(0,t.jsx)("option",{value:"",children:"Select Category"}),(0,t.jsx)("option",{value:"PPE",children:"PPE"}),(0,t.jsx)("option",{value:"Tools",children:"Tools"}),(0,t.jsx)("option",{value:"Electrical",children:"Electrical"}),(0,t.jsx)("option",{value:"Mechanical",children:"Mechanical"}),(0,t.jsx)("option",{value:"Consumables",children:"Consumables"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"SKU / Material Code"}),(0,t.jsx)("input",{type:"text",name:"materialCode",className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",placeholder:"e.g. MAT-001"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Initial Quantity"}),(0,t.jsx)("input",{type:"number",name:"qty",min:"0",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",placeholder:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Unit"}),(0,t.jsxs)("select",{name:"unit",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",children:[(0,t.jsx)("option",{value:"PCS",children:"PCS"}),(0,t.jsx)("option",{value:"KG",children:"KG"}),(0,t.jsx)("option",{value:"BOX",children:"BOX"}),(0,t.jsx)("option",{value:"SET",children:"SET"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Warehouse Location"}),(0,t.jsxs)("select",{name:"location",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",children:[(0,t.jsx)("option",{value:"",children:"Select Warehouse"}),e.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]}),(0,t.jsx)("div",{className:"flex justify-end pt-4",children:(0,t.jsx)("button",{type:"submit",disabled:o,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-lg shadow-blue-500/30 transition-all disabled:opacity-70",children:o?"Adding Item...":"Add Item"})})]})}var i=e.i(95187);let d=(0,i.createServerReference)("008dbe8372055b3750585dba6abbc5b29108e97902",i.callServer,void 0,i.findSourceMapURL,"getProjects"),c=(0,i.createServerReference)("00908b79a68343eed8fc61d4495e0498b20734f9fb",i.callServer,void 0,i.findSourceMapURL,"getWarehouses");var u=e.i(32223),m=e.i(33501),x=e.i(54786);function h({inventory:e,userName:n,stockLogs:o}){let i=(0,l.useRouter)(),[h,p]=(0,s.useState)(!1),[b,g]=(0,s.useState)("transfer"),[f,j]=(0,s.useState)(""),[y,v]=(0,s.useState)("NSTC"),[N,w]=(0,s.useState)([]),[C,S]=(0,s.useState)([]);(0,s.useEffect)(()=>{(async()=>{let[e,t]=await Promise.all([d(),c()]);e.success&&e.data&&w(e.data),t.success&&t.data&&S(t.data)})()},[]);let k=async t=>{t.preventDefault(),p(!0);let s=new FormData(t.currentTarget),r=parseInt(f),l=s.get("fromLocation"),o="lend"===b?y:l,d=s.get("toLocation"),c=parseInt(s.get("qty")),h=s.get("notes"),g=e.find(e=>e.id===r),v=g?.unit||"PCS";try{let e;"transfer"===b?e=await (0,u.transferStock)(r,c,o,d,n,v,h):"lend"===b?e=await (0,m.lendStock)(r,c,d,n,v,h):"borrow"===b&&(e=await (0,x.returnStock)(r,c,o,d,n,v,h)),e?.success?(a.toast.success(e.message),i.refresh(),t.target.reset(),j("")):a.toast.error(e?.message||"Operation failed")}catch{a.toast.error("An unexpected error occurred")}finally{p(!1)}},q=o.filter(e=>e.actionType&&(e.actionType.includes("Transfer")||e.actionType.includes("Lent")||e.actionType.includes("Returned"))).slice(0,10),R=[{header:"Date",render:e=>e.logDate?new Date(e.logDate).toLocaleString():"-"},{header:"Item",accessorKey:"itemName"},{header:"Action",accessorKey:"actionType"},{header:"Change",render:e=>(0,t.jsxs)("span",{className:e.changeAmount&&e.changeAmount>0?"text-green-600 font-bold":"text-red-600 font-bold",children:[e.changeAmount&&e.changeAmount>0?"+":"",e.changeAmount," ",e.unit]})},{header:"Location",accessorKey:"location"},{header:"User",accessorKey:"actionBy"}];return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-blue-50/50 p-4 rounded-lg text-sm text-blue-700 border border-blue-100 mb-6 flex flex-col gap-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Order Execution:"})," These actions are executed immediately."]}),(0,t.jsxs)("ul",{className:"list-disc list-inside text-xs opacity-80",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Warehouse Transfer:"})," Move items between NSTC and SNC."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Lend (Issue):"})," Issue items to a project (decreases stock)."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Borrow (Return):"})," Return items from a project (increases stock)."]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2 p-1 bg-slate-100 rounded-lg",children:[(0,t.jsx)("button",{type:"button",onClick:()=>g("transfer"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"transfer"===b?"bg-white text-blue-600 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:"Warehouse Transfer"}),(0,t.jsx)("button",{type:"button",onClick:()=>g("lend"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"lend"===b?"bg-white text-amber-600 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:"Lend (To Project)"}),(0,t.jsx)("button",{type:"button",onClick:()=>g("borrow"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"borrow"===b?"bg-white text-green-600 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:"Borrow (From Project)"})]}),(0,t.jsx)("input",{type:"hidden",name:"transferType",value:b}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Select Item"}),(0,t.jsxs)("select",{name:"itemId",required:!0,value:f,onChange:e=>j(e.target.value),className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",children:[(0,t.jsx)("option",{value:"",children:"Select an item..."}),e.filter(e=>"lend"!==b||e.location===y).map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.nameEn," (",e.qty," ",e.unit," available at ",e.location,")"]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"From Location"}),"transfer"===b&&(0,t.jsx)("select",{name:"fromLocation",className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 outline-none",children:C.length>0?C.map(e=>(0,t.jsxs)("option",{value:e.name,children:[e.name," Warehouse"]},e.id)):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("option",{value:"NSTC",children:"NSTC Warehouse"}),(0,t.jsx)("option",{value:"SNC",children:"SNC Warehouse"}),(0,t.jsx)("option",{value:"CWW",children:"CWW Warehouse"})]})}),"lend"===b&&(0,t.jsxs)("select",{name:"fromLocation",value:y,onChange:e=>{v(e.target.value),j("")},className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 outline-none",children:[(0,t.jsx)("option",{value:"NSTC",children:"NSTC Warehouse"}),(0,t.jsx)("option",{value:"SNC",children:"SNC Warehouse"}),(0,t.jsx)("option",{value:"CWW",children:"CWW Warehouse"})]}),"borrow"===b&&(0,t.jsxs)("select",{name:"fromLocation",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 outline-none",children:[(0,t.jsx)("option",{value:"",children:"Select Project..."}),N.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"To Location"}),"transfer"===b&&(0,t.jsx)("select",{name:"toLocation",className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 outline-none",children:C.length>0?C.map(e=>(0,t.jsxs)("option",{value:e.name,children:[e.name," Warehouse"]},e.id)):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("option",{value:"SNC",children:"SNC Warehouse"}),(0,t.jsx)("option",{value:"NSTC",children:"NSTC Warehouse"}),(0,t.jsx)("option",{value:"CWW",children:"CWW Warehouse"})]})}),"lend"===b&&(0,t.jsxs)("select",{name:"toLocation",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 outline-none",children:[(0,t.jsx)("option",{value:"",children:"Select Project..."}),N.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id))]}),"borrow"===b&&(0,t.jsx)("select",{name:"toLocation",className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 outline-none",children:C.length>0?C.map(e=>(0,t.jsxs)("option",{value:e.name,children:[e.name," Warehouse"]},e.id)):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("option",{value:"NSTC",children:"NSTC Warehouse"}),(0,t.jsx)("option",{value:"SNC",children:"SNC Warehouse"}),(0,t.jsx)("option",{value:"CWW",children:"CWW Warehouse"})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Quantity"}),(0,t.jsx)("input",{type:"number",name:"qty",min:"1",required:!0,className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",placeholder:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Reference / Notes"}),(0,t.jsx)("input",{type:"text",name:"notes",className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",placeholder:"Reason for transfer, PO number, etc..."})]})]}),(0,t.jsx)("div",{className:"flex justify-end pt-4",children:(0,t.jsx)("button",{type:"submit",disabled:h||!f,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-lg shadow-blue-500/30 transition-all disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2",children:h?(0,t.jsx)(t.Fragment,{children:"Processing..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,t.jsx)("path",{d:"M5 12h13M12 5l7 7-7 7"})}),"Execute Order"]})})})]}),(0,t.jsxs)("div",{className:"border-t border-slate-200 pt-8",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-slate-800",children:"Recent Movements"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"History of transfers and project issues"})]}),(0,t.jsx)(r.PremiumTable,{columns:R,data:q})]})]})}var p=e.i(26603);function b({isOpen:e,onClose:r,item:n,userName:o}){let i=(0,l.useRouter)(),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)({nameEn:n.nameEn,category:n.category||"",qty:n.qty,unit:n.unit||"PCS"});if(!e)return null;let x=async e=>{e.preventDefault(),c(!0);try{let e=await (0,p.updateInventoryItem)(n.id,{nameEn:u.nameEn,category:u.category,qty:Number(u.qty),unit:u.unit},o);e.success?(a.toast.success(e.message),i.refresh(),r()):a.toast.error(e.message)}catch{a.toast.error("Failed to update item")}finally{c(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200",children:[(0,t.jsxs)("div",{className:"px-6 py-4 border-b border-slate-100 flex justify-between items-center",children:[(0,t.jsx)("h3",{className:"font-bold text-lg text-slate-800",children:"Edit Inventory Item"}),(0,t.jsx)("button",{onClick:r,className:"text-slate-400 hover:text-slate-600 transition-colors",children:(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,t.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,t.jsxs)("form",{onSubmit:x,className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Item Name"}),(0,t.jsx)("input",{type:"text",required:!0,value:u.nameEn,onChange:e=>m({...u,nameEn:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Category"}),(0,t.jsxs)("select",{required:!0,value:u.category,onChange:e=>m({...u,category:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,t.jsx)("option",{value:"",children:"Select Category"}),(0,t.jsx)("option",{value:"PPE",children:"PPE"}),(0,t.jsx)("option",{value:"Tools",children:"Tools"}),(0,t.jsx)("option",{value:"Electrical",children:"Electrical"}),(0,t.jsx)("option",{value:"Mechanical",children:"Mechanical"}),(0,t.jsx)("option",{value:"Consumables",children:"Consumables"}),!["PPE","Tools","Electrical","Mechanical","Consumables"].includes(u.category)&&u.category&&(0,t.jsx)("option",{value:u.category,children:u.category})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Quantity"}),(0,t.jsx)("input",{type:"number",required:!0,min:"0",value:u.qty,onChange:e=>m({...u,qty:Number(e.target.value)}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Unit"}),(0,t.jsxs)("select",{required:!0,value:u.unit,onChange:e=>m({...u,unit:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,t.jsx)("option",{value:"PCS",children:"PCS"}),(0,t.jsx)("option",{value:"KG",children:"KG"}),(0,t.jsx)("option",{value:"BOX",children:"BOX"}),(0,t.jsx)("option",{value:"SET",children:"SET"})]})]})]}),(0,t.jsxs)("div",{className:"pt-4 flex justify-end gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-slate-600 hover:bg-slate-50 rounded-lg text-sm font-medium transition-colors",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors disabled:opacity-50",children:d?"Saving...":"Save Changes"})]})]})]})})}var g=e.i(20858);function f({inventory:e,supervisorName:r,defaultRegion:n,regions:o}){let i=(0,l.useRouter)(),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)(""),[x,h]=(0,s.useState)("All"),[p,b]=(0,s.useState)(n),[f,j]=(0,s.useState)({}),y=(0,s.useMemo)(()=>["All",...Array.from(new Set(e.map(e=>e.category||"Other")))],[e]),v=(0,s.useMemo)(()=>{let t=new Map;return e.forEach(e=>{if(!t.has(e.nameEn)){let s=e.nameEn.toLowerCase().includes(u.toLowerCase())||e.nameAr&&e.nameAr.includes(u),r="All"===x||e.category===x;s&&r&&t.set(e.nameEn,e)}}),Array.from(t.values())},[e,u,x]),N=async()=>{let t=Object.entries(f).map(([t,s])=>{let r=e.find(e=>e.nameEn===t);return{itemName:t,category:r?.category||"General",qty:s,unit:r?.unit||"PCS"}});if(0===t.length)return void a.toast.error("Please add at least one item to your request");c(!0);try{let e=await (0,g.createBulkRequest)(r,p,t);e.success?(a.toast.success(e.message),j({}),i.refresh()):a.toast.error(e.message)}catch{a.toast.error("Failed to submit request")}finally{c(!1)}},w=Object.keys(f).length;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("input",{type:"text",placeholder:"Search items...",value:u,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all"})}),(0,t.jsx)("div",{className:"md:w-48",children:(0,t.jsx)("select",{value:x,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",children:y.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})}),(0,t.jsx)("div",{className:"md:w-48",children:(0,t.jsxs)("select",{value:p,onChange:e=>b(e.target.value),className:"w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all font-medium text-slate-700",children:[(0,t.jsx)("option",{value:"",children:"Select Region"}),o.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id))]})})]}),(0,t.jsx)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden max-h-[600px] overflow-y-auto",children:(0,t.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,t.jsx)("thead",{className:"bg-[#F8FAFC] border-b border-slate-200 sticky top-0 z-10",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600",children:"Item Name"}),(0,t.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600",children:"Category"}),(0,t.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600",children:"Unit"}),(0,t.jsx)("th",{className:"px-6 py-4 font-semibold text-slate-600 w-32",children:"Order Qty"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-100",children:v.length>0?v.map(e=>{let s=f[e.nameEn]||"";return(0,t.jsxs)("tr",{className:`transition-colors ${s?"bg-blue-50/50":"hover:bg-slate-50/50"}`,children:[(0,t.jsx)("td",{className:"px-6 py-3 font-medium text-slate-900",children:e.nameEn}),(0,t.jsx)("td",{className:"px-6 py-3 text-slate-600",children:e.category}),(0,t.jsx)("td",{className:"px-6 py-3 text-slate-600",children:e.unit}),(0,t.jsx)("td",{className:"px-6 py-3",children:(0,t.jsx)("input",{type:"number",min:"0",placeholder:"0",value:s,onChange:t=>{var s;let r;return s=e.nameEn,r=parseInt(t.target.value),void j(e=>{let t={...e};return!isNaN(r)&&r>0?t[s]=r:delete t[s],t})},className:`w-full px-3 py-1.5 border rounded-md focus:ring-2 outline-none transition-all ${s?"border-blue-500 ring-2 ring-blue-500/20 bg-white":"border-slate-200 focus:border-blue-500 focus:ring-blue-500/20"}`})})]},e.nameEn)}):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:4,className:"px-6 py-8 text-center text-slate-500",children:"No items found matching your filter."})})})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-slate-600",children:[(0,t.jsx)("span",{className:"text-slate-900 font-bold text-lg",children:w})," items selected"]}),(0,t.jsx)("button",{onClick:N,disabled:d||0===w,className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-lg shadow-blue-500/30 transition-all disabled:opacity-50 disabled:shadow-none",children:d?"Submitting...":"Submit Bulk Order"})]})]})}var j=e.i(92714);function y({isOpen:e,onClose:r,request:l}){let[n,o]=(0,s.useState)(l.qty||0),[i,d]=(0,s.useState)(l.notes||""),[c,u]=(0,s.useState)(!1);if(!e)return null;let m=async e=>{u(!0);try{let t=await (0,j.updateRequestStatus)(l.reqId,e,n,i);t.success?(a.toast.success(`Request ${e} successfully`),r()):a.toast.error(t.message)}catch{a.toast.error("Failed to process request")}finally{u(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Review Request"}),(0,t.jsx)("button",{onClick:r,className:"text-slate-400 hover:text-slate-500 transition-colors",children:(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,t.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Item:"}),(0,t.jsx)("span",{className:"font-medium text-slate-900",children:l.itemName})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Category:"}),(0,t.jsx)("span",{className:"font-medium text-slate-900",children:l.category})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Requester:"}),(0,t.jsx)("span",{className:"font-medium text-slate-900",children:l.supervisorName})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Region:"}),(0,t.jsx)("span",{className:"font-medium text-slate-900",children:l.region})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Original Qty:"}),(0,t.jsxs)("span",{className:"font-medium text-slate-900",children:[l.qty," ",l.unit]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Approved Quantity"}),(0,t.jsx)("input",{type:"number",min:"1",value:n,onChange:e=>o(parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Notes (Optional)"}),(0,t.jsx)("textarea",{value:i,onChange:e=>d(e.target.value),placeholder:"Add reason for adjustment or rejection...",className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all h-24 resize-none"})]})]}),(0,t.jsxs)("div",{className:"p-6 border-t border-slate-100 flex justify-end gap-3 bg-slate-50",children:[(0,t.jsx)("button",{onClick:()=>m("Rejected"),disabled:c,className:"px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 font-medium transition-colors disabled:opacity-50",children:"Reject Request"}),(0,t.jsxs)("button",{onClick:()=>m("Approved"),disabled:c||n<=0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors shadow-sm disabled:opacity-50",children:["Approve ",n," ",l.unit]})]})]})})}var v=e.i(99512);function N({isOpen:e,onClose:r,request:l,userName:n}){let[o,i]=(0,s.useState)(l.qty||0),[d,c]=(0,s.useState)(!1);if(!e)return null;let u=async()=>{c(!0);try{let e=await (0,v.bulkIssueRequests)(n,[{reqId:l.reqId,qty:o,itemName:l.itemName||"",region:l.region||"",unit:l.unit||""}]);e.success?(a.toast.success(e.message),r()):a.toast.error(e.message)}catch{a.toast.error("Failed to issue request")}finally{c(!1)}},m=async()=>{if(confirm("Are you sure you want to reject this request?")){c(!0);try{let e=await (0,j.updateRequestStatus)(l.reqId,"Rejected",void 0,"Rejected by Storekeeper");e.success?(a.toast.success("Request rejected"),r()):a.toast.error(e.message)}catch{a.toast.error("Failed to reject request")}finally{c(!1)}}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:"Issue Item"}),(0,t.jsx)("button",{onClick:r,className:"text-slate-400 hover:text-slate-500 transition-colors",children:(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,t.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Region:"}),(0,t.jsx)("span",{className:"font-medium text-slate-900",children:l.region})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Item:"}),(0,t.jsx)("span",{className:"font-medium text-slate-900",children:l.itemName})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-slate-500",children:"Requested Qty:"}),(0,t.jsxs)("span",{className:"font-medium text-slate-900",children:[l.qty," ",l.unit]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Issue Quantity (Deduct from NSTC)"}),(0,t.jsx)("input",{type:"number",min:"1",value:o,onChange:e=>i(parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all"})]}),(0,t.jsx)("p",{className:"text-xs text-orange-600 bg-orange-50 p-2 rounded border border-orange-100",children:"Warning: This will be deduced immediately from NSTC warehouse stock."})]}),(0,t.jsxs)("div",{className:"p-6 border-t border-slate-100 flex justify-end gap-3 bg-slate-50",children:[(0,t.jsx)("button",{onClick:m,disabled:d,className:"px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 font-medium transition-colors disabled:opacity-50",children:"Reject"}),(0,t.jsx)("button",{onClick:u,disabled:d||o<=0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors shadow-sm disabled:opacity-50",children:"Confirm Issue"})]})]})})}var w=e.i(94440),C=e.i(46932);e.i(47167);var S=e.i(31178),k=e.i(47414),q=e.i(74008),R=e.i(21476),A=e.i(72846),I=s,T=e.i(37806);function E(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class L extends I.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,s=(0,A.isHTMLElement)(e)&&e.offsetWidth||0,r=(0,A.isHTMLElement)(e)&&e.offsetHeight||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=s-a.width-a.left,a.bottom=r-a.height-a.top}return null}componentDidUpdate(){}render(){return this.props.children}}function P({children:e,isPresent:r,anchorX:a,anchorY:l,root:n}){let o=(0,I.useId)(),i=(0,I.useRef)(null),d=(0,I.useRef)({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:c}=(0,I.useContext)(T.MotionConfigContext),u=function(...e){return s.useCallback(function(...e){return t=>{let s=!1,r=e.map(e=>{let r=E(e,t);return s||"function"!=typeof r||(s=!0),r});if(s)return()=>{for(let t=0;t<r.length;t++){let s=r[t];"function"==typeof s?s():E(e[t],null)}}}}(...e),e)}(i,e.props?.ref??e?.ref);return(0,I.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:u,right:m,bottom:x}=d.current;if(r||!i.current||!e||!t)return;let h="left"===a?`left: ${u}`:`right: ${m}`,p="bottom"===l?`bottom: ${x}`:`top: ${s}`;i.current.dataset.motionPopId=o;let b=document.createElement("style");c&&(b.nonce=c);let g=n??document.head;return g.appendChild(b),b.sheet&&b.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${t}px !important;
            ${h}px !important;
            ${p}px !important;
          }
        `),()=>{g.contains(b)&&g.removeChild(b)}},[r]),(0,t.jsx)(L,{isPresent:r,childRef:i,sizeRef:d,children:I.cloneElement(e,{ref:u})})}let D=({children:e,initial:r,isPresent:a,onExitComplete:l,custom:n,presenceAffectsLayout:o,mode:i,anchorX:d,anchorY:c,root:u})=>{let m=(0,k.useConstant)(W),x=(0,s.useId)(),h=!0,p=(0,s.useMemo)(()=>(h=!1,{id:x,initial:r,isPresent:a,custom:n,onExitComplete:e=>{for(let t of(m.set(e,!0),m.values()))if(!t)return;l&&l()},register:e=>(m.set(e,!1),()=>m.delete(e))}),[a,m,l]);return o&&h&&(p={...p}),(0,s.useMemo)(()=>{m.forEach((e,t)=>m.set(t,!1))},[a]),s.useEffect(()=>{a||m.size||!l||l()},[a]),"popLayout"===i&&(e=(0,t.jsx)(P,{isPresent:a,anchorX:d,anchorY:c,root:u,children:e})),(0,t.jsx)(R.PresenceContext.Provider,{value:p,children:e})};function W(){return new Map}var $=e.i(64978);let B=e=>e.key||"";function O(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}let U=({children:e,custom:r,initial:a=!0,onExitComplete:l,presenceAffectsLayout:n=!0,mode:o="sync",propagate:i=!1,anchorX:d="left",anchorY:c="top",root:u})=>{let[m,x]=(0,$.usePresence)(i),h=(0,s.useMemo)(()=>O(e),[e]),p=i&&!m?[]:h.map(B),b=(0,s.useRef)(!0),g=(0,s.useRef)(h),f=(0,k.useConstant)(()=>new Map),j=(0,s.useRef)(new Set),[y,v]=(0,s.useState)(h),[N,w]=(0,s.useState)(h);(0,q.useIsomorphicLayoutEffect)(()=>{b.current=!1,g.current=h;for(let e=0;e<N.length;e++){let t=B(N[e]);p.includes(t)?(f.delete(t),j.current.delete(t)):!0!==f.get(t)&&f.set(t,!1)}},[N,p.length,p.join("-")]);let C=[];if(h!==y){let e=[...h];for(let t=0;t<N.length;t++){let s=N[t],r=B(s);p.includes(r)||(e.splice(t,0,s),C.push(s))}return"wait"===o&&C.length&&(e=C),w(O(e)),v(h),null}let{forceRender:R}=(0,s.useContext)(S.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:N.map(e=>{let s=B(e),y=(!i||!!m)&&(h===N||p.includes(s));return(0,t.jsx)(D,{isPresent:y,initial:(!b.current||!!a)&&void 0,custom:r,presenceAffectsLayout:n,mode:o,root:u,onExitComplete:y?void 0:()=>{if(j.current.has(s)||(j.current.add(s),!f.has(s)))return;f.set(s,!0);let e=!0;f.forEach(t=>{t||(e=!1)}),e&&(R?.(),w(g.current),i&&x?.(),l&&l())},anchorX:d,anchorY:c,children:e},s)})})};function M({isOpen:e,onClose:r,request:l}){let[n,o]=(0,s.useState)(!1),[i,d]=(0,s.useState)({itemName:l.itemName||"",category:l.category||"General",qty:l.qty?.toString()||"0",unit:l.unit||"Piece",notes:l.notes||""}),c=async e=>{e.preventDefault(),o(!0);try{let e=await (0,w.updateRequest)(l.reqId,{itemName:i.itemName,category:i.category,qty:parseFloat(i.qty),unit:i.unit,notes:i.notes});e.success?(a.toast.success(e.message),r()):a.toast.error(e.message)}catch{a.toast.error("An error occurred")}finally{o(!1)}};return(0,t.jsx)(U,{children:e&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,t.jsxs)(C.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[(0,t.jsx)("h3",{className:"font-bold text-slate-800",children:"Edit Request"}),(0,t.jsx)("button",{onClick:r,className:"text-slate-400 hover:text-slate-600",children:(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,t.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,t.jsxs)("form",{onSubmit:c,className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Item Name"}),(0,t.jsx)("input",{type:"text",required:!0,value:i.itemName,onChange:e=>d({...i,itemName:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Category"}),(0,t.jsxs)("select",{value:i.category,onChange:e=>d({...i,category:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,t.jsx)("option",{value:"General",children:"General"}),(0,t.jsx)("option",{value:"Chemicals",children:"Chemicals"}),(0,t.jsx)("option",{value:"Tools",children:"Tools"}),(0,t.jsx)("option",{value:"Safety",children:"Safety"}),(0,t.jsx)("option",{value:"Machines",children:"Machines"}),(0,t.jsx)("option",{value:"Consumables",children:"Consumables"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Unit"}),(0,t.jsxs)("select",{value:i.unit,onChange:e=>d({...i,unit:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,t.jsx)("option",{value:"Piece",children:"Piece"}),(0,t.jsx)("option",{value:"Box",children:"Box"}),(0,t.jsx)("option",{value:"Liter",children:"Liter"}),(0,t.jsx)("option",{value:"Kg",children:"Kg"}),(0,t.jsx)("option",{value:"Gallon",children:"Gallon"}),(0,t.jsx)("option",{value:"Pair",children:"Pair"}),(0,t.jsx)("option",{value:"Set",children:"Set"}),(0,t.jsx)("option",{value:"Roll",children:"Roll"}),(0,t.jsx)("option",{value:"Drum",children:"Drum"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Quantity"}),(0,t.jsx)("input",{type:"number",min:"1",step:"0.01",required:!0,value:i.qty,onChange:e=>d({...i,qty:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Notes (Optional)"}),(0,t.jsx)("textarea",{value:i.notes,onChange:e=>d({...i,notes:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none h-20 resize-none"})]}),(0,t.jsxs)("div",{className:"flex justify-end pt-4 gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-slate-700 hover:bg-slate-100 rounded-lg font-medium transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{type:"submit",disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors shadow-sm disabled:opacity-70 flex items-center gap-2",children:[n&&(0,t.jsxs)("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Update Request"]})]})]})]})})})}var F=e.i(28201),K=e.i(71513),_=e.i(43818),Q=e.i(85697),z=e.i(46019);function G({data:n,userName:i,userRole:d="manager",userRegion:c="Riyadh"}){let u,m,x,p,g=(0,l.useRouter)(),[j,v]=(0,s.useState)("supervisor"===d?"my_requests":"storekeeper"===d?"requests":"stock"),[w,C]=(0,s.useState)(""),[S,k]=(0,s.useState)(n.warehouses[0]?.name||"NSTC"),[q,R]=(0,s.useState)("All"),[A,I]=(0,s.useState)(!1),[T,E]=(0,s.useState)({}),[L,P]=(0,s.useState)(""),[D,W]=(0,s.useState)("All"),[$,B]=(0,s.useState)(null),[O,U]=(0,s.useState)(!1),[G,H]=(0,s.useState)(null),[X,V]=(0,s.useState)(!1),[Y,J]=(0,s.useState)(null),[Z,ee]=(0,s.useState)(!1),[et,es]=(0,s.useState)(null),[er,ea]=(0,s.useState)(!1),el=async e=>{try{let t=await (0,K.confirmReceipt)(e);t.success?(a.toast.success(t.message),g.refresh()):a.toast.error(t.message)}catch{a.toast.error("Failed to confirm receipt")}},en=async()=>{if("All"===q)return void a.toast.error("Please select a specific region for stocktake");if(!confirm(`Submit stocktake for ${q}?`))return;let e=Object.entries(T).map(([e,t])=>({itemName:e,qty:t}));if(0===e.length)return void a.toast.info("No changes to submit");try{let t=await (0,_.bulkUpdateLocalInventory)(q,e,i);t.success?(a.toast.success(t.message),I(!1),E({}),g.refresh()):a.toast.error(t.message)}catch{a.toast.error("Failed to submit stocktake")}},eo=async e=>{if(confirm("Are you sure you want to delete this item?"))try{let t=await (0,F.deleteInventoryItem)(e);t.success?(a.toast.success(t.message),g.refresh()):a.toast.error(t.message)}catch{a.toast.error("Failed to delete item")}},ei=n.inventory.filter(e=>e.location===S).filter(e=>e.nameEn.toLowerCase().includes(w.toLowerCase())||e.nameAr&&e.nameAr.includes(w)),ed=n.inventory,ec=[{header:"Item Name",accessorKey:"nameEn",render:e=>(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"font-medium text-slate-900",children:e.nameEn})})},{header:"Category",accessorKey:"category"},{header:"Quantity",accessorKey:"qty",render:e=>(0,t.jsxs)("span",{className:`font-bold ${e.qty<10?"text-red-500":"text-slate-700"}`,children:[e.qty," ",e.unit]})},{header:"Warehouse",render:()=>(0,t.jsx)("span",{className:"px-2 py-1 rounded-md bg-blue-50 text-blue-700 text-xs font-semibold",children:S})}],eu=[{header:"Region",accessorKey:"region"},{header:"Item Details",render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-bold text-slate-800",children:e.itemName}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:e.category})]})},{header:"Quantity",render:e=>(0,t.jsxs)("span",{className:"font-semibold text-slate-700",children:[e.qty," ",e.unit]})},{header:"Supervisor",accessorKey:"supervisorName"},{header:"Date",render:e=>e.requestDate?new Date(e.requestDate).toLocaleDateString():"-"},..."storekeeper"===d?[{header:"Approved By",render:e=>(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium text-slate-900",children:e.approvedBy||"-"}),e.approvedAt&&(0,t.jsx)("span",{className:"text-xs text-slate-500",children:new Date(e.approvedAt).toLocaleDateString()})]})}]:[],{header:"Status",render:e=>(0,t.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${"Pending"===e.status?"bg-yellow-100 text-yellow-800":"Approved"===e.status?"bg-green-100 text-green-800":"Issued"===e.status?"bg-blue-100 text-blue-800":"bg-slate-100 text-slate-800"}`,children:e.status})}],em=[{header:"Date",render:e=>e.logDate?new Date(e.logDate).toLocaleString():"-"},{header:"Item",accessorKey:"itemName"},{header:"Change",accessorKey:"changeAmount",render:e=>(0,t.jsxs)("span",{className:`font-semibold ${e.changeAmount&&e.changeAmount>0?"text-green-600":"text-red-600"}`,children:[e.changeAmount&&e.changeAmount>0?"+":"",e.changeAmount," ",e.unit]})},{header:"New Qty",accessorKey:"newQty"},{header:"Action",accessorKey:"actionType"},{header:"User",accessorKey:"actionBy"}],ex=[{header:"Item Name",accessorKey:"itemName"},{header:"Quantity",accessorKey:"qty",render:e=>(0,t.jsx)("span",{className:"font-bold text-slate-700",children:e.qty})},{header:"Region",accessorKey:"region",render:e=>(0,t.jsx)("span",{className:"px-2 py-1 rounded-md bg-slate-100 text-slate-700 text-xs font-semibold",children:e.region})},{header:"Last Updated",render:e=>e.lastUpdated?new Date(e.lastUpdated).toLocaleDateString():"-"}],eh=c?c.split(",").map(e=>e.trim()):[],ep="supervisor"===d&&eh.length>0?n.regions.filter(e=>eh.includes(e.name)):n.regions,eb=n.localInventory.filter(e=>("supervisor"!==d||!!eh.includes(e.region))&&("All"===q||e.region===q)),eg="supervisor"===d?eh:n.regions.map(e=>e.name);return(0,t.jsxs)("div",{className:"space-y-6 animate-fade-in pb-12",children:[(0,t.jsx)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"Inventory Management"}),(0,t.jsx)("p",{className:"text-slate-500 text-sm",children:"Manage stock, transfers, and warehouse operations"})]})}),(0,t.jsx)("div",{className:"bg-white p-1 rounded-xl border border-slate-200 inline-flex shadow-sm overflow-x-auto max-w-full",children:(u=[],"manager"===d?u=["stock","add","transfer","requests","tracking","approved","audit","regional_stock","logs"]:"storekeeper"===d?u=["requests","approved","stock"]:"supervisor"===d&&(u=["my_requests","rejected","new_request","local_stock"]),u.map(e=>(0,t.jsx)("button",{onClick:()=>v(e),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${j===e?"bg-blue-600 text-white shadow-sm":"text-slate-600 hover:bg-slate-50 hover:text-slate-900"}`,children:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},e)))}),"add"===j&&(0,t.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"Add New Inventory Item"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Create a new item in the warehouse"})]}),(0,t.jsx)("div",{className:"card-premium p-6",children:(0,t.jsx)(o,{warehouses:n.warehouses})})]}),"requests"===j&&(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"storekeeper"===d?"Approved Requests":"Pending Requests"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"storekeeper"===d?"Requests waiting for issuance":"Requests requiring approval"})]}),(0,t.jsx)(z.ExportButton,{data:("storekeeper"===d?n.approvedRequests:n.pendingRequests).map(e=>({Region:e.region,Item:e.itemName,Quantity:e.qty,Unit:e.unit,Supervisor:e.supervisorName,Date:e.requestDate?new Date(e.requestDate).toLocaleDateString():"-",Status:e.status})),fileName:`${"storekeeper"===d?"Approved":"Pending"}_Requests_${new Date().toISOString().split("T")[0]}`})]}),(()=>{let s="storekeeper"===d?n.approvedRequests:n.pendingRequests;if(0===s.length)return(0,t.jsx)("div",{className:"text-center py-12 text-slate-500 bg-slate-50 rounded-xl border border-slate-100 italic",children:"storekeeper"===d?"No approved requests to issue":"No pending requests"});let l=s.reduce((e,t)=>{let s=t.region||"Unassigned";return e[s]||(e[s]=[]),e[s].push(t),e},{}),o=async(t,s)=>{if(confirm(`Approve all ${s.length} requests for ${t}?`))try{let t=s.map(e=>e.reqId),{bulkApproveRequests:r}=await e.A(42366),l=await r(t);l.success?(a.toast.success(l.message),g.refresh()):a.toast.error(l.message)}catch{a.toast.error("Failed to approve requests")}},c=async(t,s)=>{let r=prompt(`Reject all ${s.length} requests for ${t}? Enter reason:`);if(null!==r)try{let t=s.map(e=>e.reqId),{bulkRejectRequests:l}=await e.A(42366),n=await l(t,r||"No reason provided");n.success?(a.toast.success(n.message),g.refresh()):a.toast.error(n.message)}catch{a.toast.error("Failed to reject requests")}},u=async(t,s)=>{if(confirm(`Issue all ${s.length} requests for ${t}? This will deduct stock from NSTC.`))try{let r=s.map(e=>({reqId:e.reqId,qty:e.qty||0,itemName:e.itemName||"Unknown",region:t,unit:e.unit||"pcs"})),{bulkIssueRequests:l}=await e.A(42366),n=await l(i,r);n.success?(a.toast.success(n.message),g.refresh()):a.toast.error(n.message)}catch{a.toast.error("Failed to issue requests")}};return Object.entries(l).sort().map(([e,s])=>(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${"storekeeper"===d?"bg-green-500":"bg-yellow-400"}`}),e]}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-slate-500 bg-white px-2 py-1 rounded-full border border-slate-200 mr-2",children:[s.length," Requests"]}),"storekeeper"===d?(0,t.jsx)("button",{onClick:()=>u(e,s),className:"px-3 py-1.5 bg-blue-600 text-white rounded-md text-xs font-medium hover:bg-blue-700 transition-colors shadow-sm",children:"Issue All"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>c(e,s),className:"px-3 py-1.5 bg-white border border-red-200 text-red-600 rounded-md text-xs font-medium hover:bg-red-50 transition-colors shadow-sm",children:"Reject All"}),(0,t.jsx)("button",{onClick:()=>o(e,s),className:"px-3 py-1.5 bg-green-600 text-white rounded-md text-xs font-medium hover:bg-green-700 transition-colors shadow-sm",children:"Approve All"})]})]})]}),(0,t.jsx)(r.PremiumTable,{columns:eu,data:s,actions:e=>"storekeeper"===d?(0,t.jsx)("button",{onClick:()=>{J(e),ee(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 shadow-sm",children:"Issue"}):(0,t.jsx)("button",{onClick:()=>{H(e),V(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 shadow-sm",children:"Review"})})]},e))})()]}),"approved"===j&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"Approved Requests"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"History of approved supply requests"})]}),(0,t.jsx)(z.ExportButton,{data:n.approvedRequests.map(e=>({Region:e.region,Item:e.itemName,Quantity:e.qty,Unit:e.unit,Supervisor:e.supervisorName,Date:e.requestDate?new Date(e.requestDate).toLocaleDateString():"-",Approver:e.approvedBy||"-",Status:e.status})),fileName:`Approved_Requests_${new Date().toISOString().split("T")[0]}`})]}),0===n.approvedRequests.length?(0,t.jsx)("div",{className:"text-center py-12 text-slate-500 bg-slate-50 rounded-xl border border-slate-100 italic",children:"No approved requests found"}):(0,t.jsx)(r.PremiumTable,{columns:eu,data:n.approvedRequests})]}),"tracking"===j&&(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"Request Tracking"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Lifecycle view of all requests"})]}),(0,t.jsx)(z.ExportButton,{data:(n.allRequests||[]).map(e=>({Region:e.region,Item:e.itemName,Quantity:e.qty,Unit:e.unit,Supervisor:e.supervisorName,Date:e.requestDate?new Date(e.requestDate).toLocaleDateString():"-",Status:e.status,Approver:e.approvedBy||"-",IssuedBy:e.issuedBy||"-",Notes:e.notes||"-"})),fileName:`Tracking_Requests_${new Date().toISOString().split("T")[0]}`})]}),n.allRequests&&0!==n.allRequests.length?Object.entries((n.allRequests||[]).reduce((e,t)=>{let s=t.region||"Unassigned";return e[s]||(e[s]=[]),e[s].push(t),e},{})).sort().map(([e,s])=>(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-6 py-3 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[(0,t.jsxs)("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),e]}),(0,t.jsxs)("span",{className:"text-xs font-medium text-slate-500 bg-white px-2 py-1 rounded-full border border-slate-200",children:[s.length," Requests"]})]}),(0,t.jsx)(r.PremiumTable,{columns:[...eu,{header:"Approver",accessorKey:"approvedBy"},{header:"Issued By",accessorKey:"issuedBy"}],data:s})]},e)):(0,t.jsx)("div",{className:"text-center py-12 text-slate-500 bg-slate-50 rounded-xl border border-slate-100 italic",children:"No requests found"})]}),"rejected"===j&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-red-600",children:"Rejected Requests"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Requests rejected by management"})]})}),n.myRejectedRequests&&0!==n.myRejectedRequests.length?(0,t.jsx)(r.PremiumTable,{columns:[{header:"Item",accessorKey:"itemName"},{header:"Quantity",render:e=>(0,t.jsxs)("span",{className:"font-semibold text-slate-700",children:[e.qty," ",e.unit]})},{header:"Date",render:e=>e.requestDate?new Date(e.requestDate).toLocaleDateString():"-"},{header:"Reason",render:e=>(0,t.jsx)("div",{className:"text-red-600 font-medium bg-red-50 p-2 rounded-md border border-red-100 text-sm",children:e.notes||"No reason provided"})}],data:n.myRejectedRequests}):(0,t.jsx)("div",{className:"text-center py-12 text-slate-500 bg-slate-50 rounded-xl border border-slate-100 italic",children:"No rejected requests"})]}),"audit"===j&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"Audit Logs"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"System activities and tracked actions"})]}),(0,t.jsx)(z.ExportButton,{data:n.auditLogs.map(e=>({Date:new Date(e.timestamp).toLocaleString(),User:e.userName,Action:e.action,Module:e.module,Details:e.details})),fileName:`Audit_Logs_${new Date().toISOString().split("T")[0]}`})]}),(0,t.jsx)(r.PremiumTable,{columns:[{header:"Timestamp",render:e=>new Date(e.timestamp).toLocaleString()},{header:"User",accessorKey:"userName"},{header:"Action",accessorKey:"action"},{header:"Module",accessorKey:"module"},{header:"Details",accessorKey:"details"}],data:n.auditLogs})]}),"transfer"===j&&(0,t.jsx)(h,{inventory:ed,userName:i,stockLogs:n.stockLogs}),(0,t.jsxs)("div",{className:"card-premium p-6 min-h-[500px]",children:["stock"===j&&(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,t.jsx)("div",{className:"relative flex-1",children:(0,t.jsx)("input",{type:"text",placeholder:"Search items by name...",value:w,onChange:e=>C(e.target.value),className:"w-full pl-4 pr-10 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})}),(0,t.jsx)("div",{className:"flex rounded-lg bg-slate-100 p-1",children:n.warehouses.length>0?n.warehouses.filter(e=>"CWW"!==e.name).map(e=>(0,t.jsxs)("button",{onClick:()=>k(e.name),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${S===e.name?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.name," Warehouse"]},e.id)):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>k("NSTC"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${"NSTC"===S?"bg-white text-blue-600 shadow-sm":"text-slate-500"}`,children:"NSTC Warehouse"}),(0,t.jsx)("button",{onClick:()=>k("SNC"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${"SNC"===S?"bg-white text-blue-600 shadow-sm":"text-slate-500"}`,children:"SNC Warehouse"})]})})]}),"stock"===j&&(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(z.ExportButton,{data:ei.map(e=>({Name:e.nameEn,Category:e.category,Quantity:e.qty,Unit:e.unit,Warehouse:e.location,Status:e.status})),fileName:`Inventory_Stock_${new Date().toISOString().split("T")[0]}`})}),(()=>{if(0===ei.length)return(0,t.jsx)("div",{className:"text-center py-12 text-slate-500 bg-slate-50 rounded-xl border border-slate-100 italic",children:"No items found"});let e={};return ei.forEach(t=>{let s=t.category||"Uncategorized";e[s]||(e[s]=[]),e[s].push(t)}),Object.entries(e).sort().map(([e,s])=>(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[(0,t.jsxs)("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),e]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(z.ExportButton,{data:s.map(e=>({Name:e.nameEn,Category:e.category,Quantity:e.qty,Unit:e.unit,Location:e.location})),fileName:`${e}_Inventory`,label:"Export",className:"bg-slate-600 hover:bg-slate-700"}),(0,t.jsxs)("span",{className:"text-xs font-medium text-slate-500 bg-white px-2 py-1 rounded-full border border-slate-200 flex items-center",children:[s.length," Items"]})]})]}),(0,t.jsx)(r.PremiumTable,{columns:ec,data:s,actions:e=>(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{B(e),U(!0)},className:"text-blue-600 hover:text-blue-800 font-medium text-sm",children:"Edit"}),(0,t.jsx)("button",{onClick:()=>eo(e.id),className:"text-red-600 hover:text-red-800 font-medium text-sm",children:"Delete"})]})})]},e))})()]}),"logs"===j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex justify-end mb-4",children:(0,t.jsx)(z.ExportButton,{data:n.stockLogs.map(e=>({Date:e.logDate?new Date(e.logDate).toLocaleString():"-",Item:e.itemName,Change:e.changeAmount,NewQty:e.newQty,Action:e.actionType,User:e.actionBy,Location:e.location})),fileName:`Stock_Logs_${new Date().toISOString().split("T")[0]}`})}),(0,t.jsx)(r.PremiumTable,{columns:em,data:n.stockLogs})]}),"new_request"===j&&(0,t.jsxs)("div",{className:"max-w-3xl mx-auto py-4",children:[(0,t.jsxs)("div",{className:"mb-6 border-b border-slate-100 pb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"New Supply Request"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Request items for your region"})]}),(0,t.jsx)(f,{inventory:n.inventory,supervisorName:i,defaultRegion:c||"",regions:ep})]}),"my_requests"===j&&(0,t.jsxs)("div",{className:"space-y-8",children:[n.readyForPickup.length>0&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-green-700 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500"}),"Ready for Pickup"]}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Please collect these items and confirm receipt"})]}),(m=async(e,t)=>{if(confirm(`Confirm receipt for all ${t.length} items in ${e}?`))try{let e=t.map(e=>e.reqId),s=await (0,Q.bulkConfirmReceipt)(e);s.success?(a.toast.success(s.message),g.refresh()):a.toast.error(s.message)}catch{a.toast.error("Failed to confirm receipts")}},Object.entries(n.readyForPickup.reduce((e,t)=>{let s=t.region||"Unassigned";return e[s]||(e[s]=[]),e[s].push(t),e},{})).sort().map(([e,s])=>(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[(0,t.jsxs)("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500"}),e]}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-slate-500 bg-white px-2 py-1 rounded-full border border-slate-200",children:[s.length," Items"]}),(0,t.jsx)("button",{onClick:()=>m(e,s),className:"text-xs bg-green-600 text-white px-3 py-1.5 rounded-md font-medium hover:bg-green-700 transition-colors shadow-sm",children:"Confirm All"})]})]}),(0,t.jsx)(r.PremiumTable,{columns:eu,data:s,actions:e=>(0,t.jsx)("button",{onClick:()=>el(e.reqId),className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm font-medium hover:bg-green-700 transition-colors shadow-sm",children:"Confirm Receipt"})})]},e)))]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("h3",{className:"text-lg font-bold text-slate-700",children:"Pending Requests"})}),n.myPendingRequests&&0!==n.myPendingRequests.length?Object.entries(n.myPendingRequests.reduce((e,t)=>{let s=t.region||"Unassigned";return e[s]||(e[s]=[]),e[s].push(t),e},{})).sort().map(([e,s])=>(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mb-4",children:[(0,t.jsxs)("div",{className:"px-6 py-3 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[(0,t.jsxs)("h3",{className:"font-bold text-slate-700 flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-yellow-400"}),e]}),(0,t.jsxs)("span",{className:"text-xs font-medium text-slate-500 bg-white px-2 py-1 rounded-full border border-slate-200",children:[s.length," Requests"]})]}),(0,t.jsx)(r.PremiumTable,{columns:eu,data:s,actions:e=>(0,t.jsx)("button",{onClick:()=>{es(e),ea(!0)},className:"px-3 py-1 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-md text-xs font-medium transition-colors",children:"Edit"})})]},e)):(0,t.jsx)("div",{className:"text-center py-8 text-slate-500 bg-slate-50 rounded-lg border border-slate-100 italic",children:"No pending requests"})]})]}),"regional_stock"===j&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-slate-800",children:"Regional Stock Overview"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Inventory levels across all project regions"})]})}),0===n.localInventory.length?(0,t.jsx)("div",{className:"text-center py-12 text-slate-500 bg-slate-50 rounded-xl border border-slate-100 italic",children:"No regional stock data available"}):(x=n.localInventory.filter(e=>"supervisor"!==d||eh.includes(e.region)),p={},x.forEach(e=>{let t=e.region||"Unassigned";p[t]||(p[t]=[]),p[t].push(e)}),Object.entries(p).sort().map(([e,s])=>(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mb-6",children:[(0,t.jsxs)("div",{className:"px-6 py-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-2.5 h-2.5 rounded-full bg-blue-600"}),e," Region"]}),(0,t.jsxs)("span",{className:"px-3 py-1 bg-white border border-slate-200 rounded-full text-xs font-medium text-slate-500",children:[s.reduce((e,t)=>e+(t.qty||0),0)," Total Items"]})]}),(0,t.jsx)(r.PremiumTable,{columns:ex,data:s})]},e)))]}),"local_stock"===j&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-lg font-bold text-slate-900",children:["Local Stock - ","All"===q?"All Regions":q]}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Current inventory in your region"})]})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{onClick:()=>R("All"),className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${"All"===q?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-600 border-slate-200 hover:border-slate-300"}`,children:"All"}),eg.map(e=>(0,t.jsx)("button",{onClick:()=>R(e),className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${q===e?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-600 border-slate-200 hover:border-slate-300"}`,children:e},e))]})]}),A?(0,t.jsxs)("div",{className:"bg-slate-50 p-6 rounded-xl border border-slate-200",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-slate-800",children:["Stocktake: ",q]}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Enter current counts for all items."})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>I(!1),className:"px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium text-sm",children:"Cancel"}),(0,t.jsx)("button",{onClick:en,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium text-sm shadow-sm",children:"Submit Stocktake"})]})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("input",{type:"text",placeholder:"Search items...",value:L,onChange:e=>P(e.target.value),className:"flex-1 px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"}),(0,t.jsxs)("select",{value:D,onChange:e=>W(e.target.value),className:"px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,t.jsx)("option",{value:"All",children:"All Categories"}),Array.from(new Set(n.inventory.map(e=>e.category||"Uncategorized"))).sort().map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from(new Set(n.inventory.map(e=>e.nameEn))).filter(e=>{if(L&&!e.toLowerCase().includes(L.toLowerCase()))return!1;if("All"!==D){let t=n.inventory.find(t=>t.nameEn===e);if(t?.category!==D)return!1}return!0}).sort().map(e=>{let s=T[e]??0;return(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-slate-200 shadow-sm flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-medium text-slate-700 truncate mr-2",title:e,children:e}),(0,t.jsx)("input",{type:"number",min:"0",value:s,onChange:t=>{let s=parseInt(t.target.value)||0;E(t=>({...t,[e]:s}))},className:"w-24 px-3 py-1 border border-slate-200 rounded focus:ring-2 focus:ring-blue-500 outline-none text-right font-mono"})]},e)})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex justify-end mb-4",children:(0,t.jsxs)("button",{onClick:()=>{if("All"===q)return void a.toast.error("Please select a specific region to start stocktake");let e={};n.localInventory.filter(e=>e.region===q).forEach(t=>{e[t.itemName]=t.qty??0}),E(e),I(!0)},disabled:"All"===q,className:`px-4 py-2 rounded-lg font-medium text-sm shadow-sm transition-all flex items-center gap-2 ${"All"===q?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,t.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),"Manual Stocktake"]})}),(0,t.jsx)(r.PremiumTable,{columns:ex,data:eb})]})]}),$&&(0,t.jsx)(b,{isOpen:O,onClose:()=>U(!1),item:$,userName:i}),G&&(0,t.jsx)(y,{isOpen:X,onClose:()=>{V(!1),g.refresh()},request:G}),Y&&(0,t.jsx)(N,{isOpen:Z,onClose:()=>{ee(!1),g.refresh()},request:Y,userName:i}),et&&(0,t.jsx)(M,{isOpen:er,onClose:()=>{ea(!1),g.refresh()},request:et})]})]})}e.s(["WarehouseClient",()=>G],99284)}]);