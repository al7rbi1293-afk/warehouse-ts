{"version":3,"sources":["../../../../src/app/%28dashboard%29/manpower/ManpowerClient.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/%28dashboard%29/manpower/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ManpowerClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call ManpowerClient() from the server but ManpowerClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/manpower/ManpowerClient.tsx\",\n    \"ManpowerClient\",\n);\n","import { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { ManpowerClient } from \"./ManpowerClient\";\n// Import UserRole type to use for casting\nimport { UserRole } from \"@/types\";\n\nasync function getManpowerData() {\n    try {\n        const [workers, shifts, supervisors, allAttendance, regions, allUsers] = await Promise.all([\n            prisma.worker.findMany({\n                include: { shift: true },\n                orderBy: { id: \"desc\" },\n            }),\n            prisma.shift.findMany({\n                orderBy: { id: \"asc\" },\n            }),\n            prisma.user.findMany({\n                where: { role: { not: \"manager\" } },\n                orderBy: { name: \"asc\" },\n            }),\n            prisma.attendance.findMany({\n                where: {\n                    date: {\n                        gte: new Date(new Date().setDate(new Date().getDate() - 14)), // Reduced to 14 days for performance\n                    },\n                },\n                include: { worker: true },\n                orderBy: { date: 'desc' },\n            }),\n            prisma.region.findMany({\n                orderBy: { name: \"asc\" },\n            }),\n            // Fetch all users for management tab (managers only)\n            prisma.user.findMany({\n                select: {\n                    id: true,\n                    username: true,\n                    name: true,\n                    role: true,\n                    region: true,\n                    shiftId: true,\n                    allowedShifts: true,\n                },\n                orderBy: { name: 'asc' }\n            }),\n        ]);\n\n        return {\n            workers: workers.map(w => ({\n                ...w,\n                shiftName: w.shift?.name || null,\n            })),\n            shifts,\n            supervisors: supervisors.map(s => ({\n                ...s,\n                role: s.role as UserRole | null\n            })),\n            allAttendance,\n            regions,\n            allUsers: allUsers.map(u => ({\n                ...u,\n                role: u.role as UserRole | null\n            })),\n        };\n    } catch (error) {\n        console.error(\"Manpower data error:\", error);\n        return {\n            workers: [],\n            shifts: [],\n            supervisors: [],\n            allAttendance: [],\n            regions: [],\n            allUsers: [],\n        };\n    }\n}\n\nexport default async function ManpowerPage() {\n    const session = await getServerSession(authOptions);\n\n    if (!session) {\n        return null;\n    }\n\n    const user = session.user;\n    const data = await getManpowerData();\n\n    return (\n        <ManpowerClient\n            data={data}\n            userRole={user.role}\n            userName={user.name || undefined}\n            userRegion={user.region || undefined}\n            userShiftId={user.shiftId || undefined}\n            userShiftName={(user as any).shiftName || undefined}\n            userAllowedShifts={(user as any).allowedShifts || undefined}\n        />\n    );\n}\n"],"names":[],"mappings":"8XAEO,IAAM,EAAiB,CAAA,EAAA,AAD9B,EAAA,CAAA,CAAA,OAC8B,uBAAA,AAAuB,EACjD,WAAa,MAAM,AAAI,MAAM,0OAA4O,EACzQ,gFACA,wEAHG,IAAM,EAAiB,CAAA,EAD9B,AAC8B,EAD9B,CAAA,CAAA,OAC8B,uBAAA,AAAuB,EACjD,WAAa,MAAM,AAAI,MAAM,0OAA4O,EACzQ,4DACA,qHCLJ,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAIA,eAAe,IACX,GAAI,CACA,GAAM,CAAC,EAAS,EAAQ,EAAa,EAAe,EAAS,EAAS,CAAG,MAAM,QAAQ,GAAG,CAAC,CACvF,EAAA,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CACnB,QAAS,CAAE,OAAO,CAAK,EACvB,QAAS,CAAE,GAAI,MAAO,CAC1B,GACA,EAAA,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAClB,QAAS,CAAE,GAAI,KAAM,CACzB,GACA,EAAA,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CACjB,MAAO,CAAE,KAAM,CAAE,IAAK,SAAU,CAAE,EAClC,QAAS,CAAE,KAAM,KAAM,CAC3B,GACA,EAAA,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CACvB,MAAO,CACH,KAAM,CACF,IAAK,IAAI,KAAK,IAAI,OAAO,OAAO,CAAC,IAAI,OAAO,OAAO,GAAK,IAC5D,CACJ,EACA,QAAS,CAAE,QAAQ,CAAK,EACxB,QAAS,CAAE,KAAM,MAAO,CAC5B,GACA,EAAA,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CACnB,QAAS,CAAE,KAAM,KAAM,CAC3B,GAEA,EAAA,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CACjB,OAAQ,CACJ,IAAI,EACJ,UAAU,EACV,MAAM,EACN,MAAM,EACN,QAAQ,EACR,SAAS,EACT,eAAe,CACnB,EACA,QAAS,CAAE,KAAM,KAAM,CAC3B,GACH,EAED,MAAO,CACH,QAAS,EAAQ,GAAG,CAAC,IAAK,AAAC,CACvB,GAAG,CAAC,CACJ,UAAW,EAAE,KAAK,EAAE,MAAQ,KAChC,CAAC,SACD,EACA,YAAa,EAAY,GAAG,CAAC,IAAK,AAAC,CAC/B,GAAG,CAAC,CACJ,KAAM,EAAE,IAAI,CAChB,CAAC,gBACD,UACA,EACA,SAAU,EAAS,GAAG,CAAC,IAAK,AAAC,CACzB,GAAG,CAAC,CACJ,KAAM,EAAE,IAAI,CAChB,CAAC,CACL,CACJ,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,uBAAwB,GAC/B,CACH,QAAS,EAAE,CACX,OAAQ,EAAE,CACV,YAAa,EAAE,CACf,cAAe,EAAE,CACjB,QAAS,EAAE,CACX,SAAU,EAAE,AAChB,CACJ,CACJ,CAEe,eAAe,IAC1B,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,EAAA,WAAW,EAElD,GAAI,CAAC,EACD,OADU,AACH,KAGX,IAAM,EAAO,EAAQ,IAAI,CACnB,EAAO,MAAM,IAEnB,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,cAAc,CAAA,CACX,KAAM,EACN,SAAU,EAAK,IAAI,CACnB,SAAU,EAAK,IAAI,OAAI,EACvB,WAAY,EAAK,MAAM,OAAI,EAC3B,YAAa,EAAK,OAAO,OAAI,EAC7B,cAAgB,EAAa,SAAS,OAAI,EAC1C,kBAAoB,EAAa,aAAa,OAAI,GAG9D","ignoreList":[0]}