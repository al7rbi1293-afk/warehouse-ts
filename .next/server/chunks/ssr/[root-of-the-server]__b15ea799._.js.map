{"version":3,"sources":["../../../../src/app/%28dashboard%29/warehouse/WarehouseClient.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/%28dashboard%29/warehouse/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const WarehouseClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call WarehouseClient() from the server but WarehouseClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(dashboard)/warehouse/WarehouseClient.tsx\",\n    \"WarehouseClient\",\n);\n","import { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { WarehouseClient } from \"./WarehouseClient\";\n\nasync function getWarehouseData(userRole: string, userName: string) {\n    try {\n        const [inventory, pendingRequests, approvedRequests, stockLogs, localInventory, warehouses] = await Promise.all([\n            prisma.inventory.findMany({\n                orderBy: { nameEn: \"asc\" },\n            }),\n            prisma.request.findMany({\n                where: { status: \"Pending\" },\n                orderBy: [{ region: \"asc\" }, { requestDate: \"desc\" }],\n            }),\n            prisma.request.findMany({\n                where: { status: \"Approved\" },\n                orderBy: { region: \"asc\" },\n            }),\n            prisma.stockLog.findMany({\n                orderBy: { logDate: \"desc\" },\n                take: 100, // Reduced from 500\n            }),\n            prisma.localInventory.findMany({\n                orderBy: [{ region: \"asc\" }, { itemName: \"asc\" }],\n            }),\n            prisma.warehouse.findMany({\n                orderBy: { name: \"asc\" },\n            }),\n        ]);\n\n        // If no warehouses found (e.g. migration issue), return empty or default?\n        // Let's return what we found. Client will handle fallback.\n\n        // For managers, get all requests for tracking\n        const allRequests = userRole === \"manager\"\n            ? await prisma.request.findMany({\n                orderBy: { requestDate: \"desc\" },\n                take: 200, // Reduced for performance\n            })\n            : [];\n\n        // For supervisors, get their own pending requests\n        const myPendingRequests = userRole === \"supervisor\"\n            ? await prisma.request.findMany({\n                where: { supervisorName: userName, status: \"Pending\" },\n                orderBy: { requestDate: \"desc\" },\n            })\n            : [];\n\n        // For supervisors, get their own rejected requests\n        const myRejectedRequests = userRole === \"supervisor\"\n            ? await prisma.request.findMany({\n                where: { supervisorName: userName, status: \"Rejected\" },\n                orderBy: { requestDate: \"desc\" },\n            })\n            : [];\n\n        // For supervisors, get items ready for pickup\n        const readyForPickup = userRole === \"supervisor\"\n            ? await prisma.request.findMany({\n                where: { supervisorName: userName, status: \"Issued\" },\n                orderBy: { requestDate: \"desc\" },\n            })\n            : [];\n\n        return {\n            inventory,\n            pendingRequests,\n            approvedRequests,\n            allRequests, // New\n            stockLogs,\n            localInventory,\n            myPendingRequests,\n            myRejectedRequests, // New\n            readyForPickup,\n            warehouses,\n            regions: await prisma.region.findMany({ orderBy: { name: \"asc\" } }), // Keeping existing\n\n            auditLogs: await prisma.auditLog.findMany({\n                orderBy: { timestamp: \"desc\" },\n                take: 50\n            }),\n        };\n    } catch (error) {\n        console.error(\"Warehouse data error:\", error);\n        return {\n            inventory: [],\n            pendingRequests: [],\n            approvedRequests: [],\n            stockLogs: [],\n            localInventory: [],\n            myPendingRequests: [],\n            readyForPickup: [],\n            warehouses: [],\n            regions: [],\n            auditRequests: [],\n            auditLogs: []\n        };\n    }\n}\n\nexport default async function WarehousePage() {\n    const session = await getServerSession(authOptions);\n\n    if (!session) {\n        return null;\n    }\n\n    const user = session.user;\n    const data = await getWarehouseData(user.role, user.name || \"\");\n\n    return (\n        <WarehouseClient\n            data={data}\n            userRole={user.role}\n            userName={user.name || \"\"}\n            userRegion={user.region}\n        />\n    );\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}