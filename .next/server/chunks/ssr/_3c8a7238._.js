module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},94781,a=>{"use strict";var b=a.i(37936),c=a.i(66518);async function d(a,b,d,e){try{await c.prisma.auditLog.create({data:{userName:a,action:b,details:d,module:e,timestamp:new Date}})}catch(a){console.error("Failed to create audit log:",a)}}(0,a.i(13095).ensureServerEntryExports)([d]),(0,b.registerServerReference)(d,"78c51af32ff8839f5a7ab2c46ce6426546ad16c26a",null),a.s(["logAudit",()=>d])},90376,a=>{"use strict";var b=a.i(37936),c=a.i(66518),d=a.i(18558),e=a.i(20971),f=a.i(9307),g=a.i(94781),h=a.i(13095);async function i(a){let b=await (0,e.getServerSession)(f.authOptions);if(!b||!["manager","supervisor"].includes(b.user.role))return{success:!1,message:"Unauthorized"};let h=a.get("name"),i=a.get("empId"),j=a.get("role"),k=a.get("region"),l=a.get("shiftId");try{return await c.prisma.worker.create({data:{name:h,empId:i,role:j,region:k,shiftId:l?parseInt(l):null,status:"Active"}}),await (0,g.logAudit)(b.user.name||b.user.username,"Create Worker",`Created worker ${h} (${j})`,"Manpower"),(0,d.revalidatePath)("/manpower"),{success:!0,message:"Worker added successfully"}}catch(a){return console.error("Create worker error:",a),{success:!1,message:"Failed to add worker"}}}async function j(a,b){let h=await (0,e.getServerSession)(f.authOptions);if(!h||!["manager","supervisor"].includes(h.user.role))return{success:!1,message:"Unauthorized"};try{return await c.prisma.worker.update({where:{id:a},data:b}),await (0,g.logAudit)(h.user.name||h.user.username,"Update Worker",`Updated worker ID ${a}`,"Manpower"),(0,d.revalidatePath)("/manpower"),{success:!0,message:"Worker updated successfully"}}catch(a){return console.error("Update worker error:",a),{success:!1,message:"Failed to update worker"}}}async function k(a){let b=await (0,e.getServerSession)(f.authOptions);if(!b||!["manager"].includes(b.user.role))return{success:!1,message:"Unauthorized: Managers only"};try{return await c.prisma.attendance.deleteMany({where:{workerId:a}}),await c.prisma.worker.delete({where:{id:a}}),await (0,g.logAudit)(b.user.name||b.user.username,"Delete Worker",`Deleted worker ID ${a}`,"Manpower"),(0,d.revalidatePath)("/manpower"),{success:!0,message:"Worker deleted successfully"}}catch(a){return console.error("Delete worker error:",a),{success:!1,message:"Failed to delete worker"}}}async function l(a){let b=await (0,e.getServerSession)(f.authOptions);if(!b||!["manager"].includes(b.user.role))return{success:!1,message:"Unauthorized: Managers only"};let h=a.get("name"),i=a.get("startTime"),j=a.get("endTime");try{return await c.prisma.shift.create({data:{name:h,startTime:i,endTime:j}}),await (0,g.logAudit)(b.user.name||b.user.username,"Create Shift",`Created shift ${h}`,"Manpower"),(0,d.revalidatePath)("/manpower"),{success:!0,message:"Shift added successfully"}}catch(a){return console.error("Create shift error:",a),{success:!1,message:"Failed to add shift"}}}async function m(a,b,h,i,j,k){let l=await (0,e.getServerSession)(f.authOptions);if(!l||!["manager","supervisor"].includes(l.user.role))return{success:!1,message:"Unauthorized"};try{return await c.prisma.attendance.deleteMany({where:{workerId:a,date:new Date(b),shiftId:j}}),await c.prisma.attendance.create({data:{workerId:a,date:new Date(b),status:h,notes:i||null,shiftId:j,supervisor:k}}),await (0,g.logAudit)(l.user.name||l.user.username,"Submit Attendance",`Recorded attendance for worker ID ${a} (${h})`,"Manpower"),(0,d.revalidatePath)("/manpower"),{success:!0,message:"Attendance recorded"}}catch(a){return console.error("Submit attendance error:",a),{success:!1,message:"Failed to record attendance"}}}async function n(a,b,h,i){let j=await (0,e.getServerSession)(f.authOptions);if(!j||!["manager","supervisor"].includes(j.user.role))return{success:!1,message:"Unauthorized"};try{let e=new Date(b),f=a.map(a=>a.workerId);return await c.prisma.$transaction(async b=>{await b.attendance.deleteMany({where:{workerId:{in:f},date:e}}),await b.attendance.createMany({data:a.map(a=>({workerId:a.workerId,date:e,status:a.status,notes:a.notes||null,shiftId:a.shiftId??(h||null),supervisor:i}))})}),await (0,g.logAudit)(j.user.name||j.user.username,"Bulk Attendance",`Submitted attendance for ${a.length} workers`,"Manpower"),(0,d.revalidatePath)("/manpower"),{success:!0,message:`Recorded attendance for ${a.length} workers`}}catch(a){return console.error("Bulk attendance error:",a),{success:!1,message:"Failed to record attendance"}}}async function o(a,b,h,i,j){let k=await (0,e.getServerSession)(f.authOptions);if(!k||!["manager"].includes(k.user.role))return{success:!1,message:"Unauthorized: Managers only"};try{return await c.prisma.user.update({where:{username:a},data:{region:b,role:h,shiftId:i,allowedShifts:j||null}}),await (0,g.logAudit)(k.user.name||k.user.username,"Update Profile",`Updated profile for ${a}`,"Manpower"),(0,d.revalidatePath)("/manpower"),{success:!0,message:"Profile updated successfully"}}catch(a){return console.error("Update supervisor error:",a),{success:!1,message:"Failed to update profile"}}}async function p(){try{let a=await c.prisma.user.findMany({include:{shift:!0},orderBy:{createdAt:"desc"}});return{success:!0,data:a}}catch(a){return console.error("Get users error:",a),{success:!1,error:"Failed to fetch users"}}}async function q(a){let b=await (0,e.getServerSession)(f.authOptions);if(b?.user.role!=="manager")return{success:!1,message:"Unauthorized: Only managers can create users"};try{if(await c.prisma.user.findUnique({where:{username:a.username}}))return{success:!1,message:"Username already exists"};let b=await (0,f.hashPassword)(a.password);return await c.prisma.user.create({data:{username:a.username,password:b,name:a.name||"",role:a.role||"staff",region:a.region,shiftId:a.shiftId?parseInt(a.shiftId):null,allowedShifts:a.allowedShifts||null}}),(0,d.revalidatePath)("/manpower"),{success:!0,message:"User created successfully"}}catch(a){return console.error("Create user error:",a),{success:!1,message:"Failed to create user"}}}async function r(a,b){let g=await (0,e.getServerSession)(f.authOptions);if(g?.user.role!=="manager")return{success:!1,message:"Unauthorized: Only managers can update users"};try{let e={};return b.name&&(e.name=b.name),b.role&&(e.role=b.role),void 0!==b.region&&(e.region=b.region),void 0!==b.shiftId&&(e.shiftId=b.shiftId?Number(b.shiftId):null),void 0!==b.allowedShifts&&(e.allowedShifts=b.allowedShifts),b.password&&""!==b.password.trim()&&(e.password=await (0,f.hashPassword)(b.password)),await c.prisma.user.update({where:{username:a},data:e}),(0,d.revalidatePath)("/manpower"),{success:!0,message:"User updated successfully"}}catch(a){return console.error("Update user error:",a),{success:!1,message:"Failed to update user"}}}async function s(a){let b=await (0,e.getServerSession)(f.authOptions);if(b?.user.role!=="manager")return{success:!1,message:"Unauthorized: Only managers can delete users"};try{return await c.prisma.user.delete({where:{username:a}}),(0,d.revalidatePath)("/manpower"),{success:!0,message:"User deleted successfully"}}catch(a){return console.error("Delete user error:",a),{success:!1,message:"Failed to delete user"}}}async function t(){let a=await (0,e.getServerSession)(f.authOptions);if(!a||!["manager","admin"].includes(a.user.role))return{success:!1,message:"Unauthorized"};try{let a=await c.prisma.user.findMany({orderBy:{name:"asc"},select:{id:!0,name:!0,username:!0,role:!0,region:!0,shift:{select:{name:!0}}}});return{success:!0,data:a}}catch(a){return console.error("Error fetching staff:",a),{success:!1,message:"Failed to fetch staff"}}}async function u(a){let b=await (0,e.getServerSession)(f.authOptions);if(!b||!["manager","admin"].includes(b.user.role))return{success:!1,message:"Unauthorized"};try{let b=await c.prisma.staffAttendance.findMany({where:{date:new Date(a)},include:{user:{select:{name:!0,role:!0}},coverUser:{select:{name:!0}}}});return{success:!0,data:b}}catch(a){return console.error("Error fetching staff attendance:",a),{success:!1,message:"Failed to fetch attendance"}}}async function v(a,b,g,h,i){let j=await (0,e.getServerSession)(f.authOptions);if(!j||!["manager","admin"].includes(j.user.role))return{success:!1,message:"Unauthorized"};try{return await c.prisma.staffAttendance.upsert({where:{userId_date:{userId:a,date:new Date(g)}},update:{status:b,coveredBy:"Absent"===b?h:null,notes:i},create:{userId:a,date:new Date(g),status:b,coveredBy:"Absent"===b?h:null,notes:i}}),(0,d.revalidatePath)("/manpower"),{success:!0,message:"Staff attendance updated"}}catch(a){return console.error("Error updating staff attendance:",a),{success:!1,message:"Failed to update attendance"}}}(0,h.ensureServerEntryExports)([i,j,k,l,m,n,o]),(0,b.registerServerReference)(i,"406ac2ac175b3d146fe1ff4c98a98f6f06817b4a46",null),(0,b.registerServerReference)(j,"6009307487f0bcc002ea2a06712ef0cf5b14151857",null),(0,b.registerServerReference)(k,"40314a5461dbdec936ffdaef9ba3d3c5a796eb01a5",null),(0,b.registerServerReference)(l,"409eb8bf7917e2c1f27c2e91a383af5d4a4f6b3c0a",null),(0,b.registerServerReference)(m,"7e100fe5c701d22c7c3ea4ae0e5e116e85f43e7280",null),(0,b.registerServerReference)(n,"780ee3cc288d83043e5027befdbb35280be76f20f0",null),(0,b.registerServerReference)(o,"7c62c798b577b1b02290601f2346f1a9ed110b82bc",null),(0,h.ensureServerEntryExports)([p,q,r,s]),(0,b.registerServerReference)(p,"008bf0366e5cf7c30842ce935afcc6361e95d2ba5e",null),(0,b.registerServerReference)(q,"40ee2ba9059aa813d068939e092131fc7754826348",null),(0,b.registerServerReference)(r,"60a83923fc2a86194187f0e847e5fddd3c120dcc97",null),(0,b.registerServerReference)(s,"4034125df2cbdc005c8af2030decfdd3f9c1030b38",null),(0,h.ensureServerEntryExports)([t,u,v]),(0,b.registerServerReference)(t,"0003c8a1bd8ed2fe6e53cb9e9606d4dbea40fd5571",null),(0,b.registerServerReference)(u,"40a6297af27422d4551288b5192f26872415ba489b",null),(0,b.registerServerReference)(v,"7c6dc3d93bd39156d689187aa772474e629cd3f5e5",null),a.s([],7411),a.i(7411),a.s(["0003c8a1bd8ed2fe6e53cb9e9606d4dbea40fd5571",()=>t,"40314a5461dbdec936ffdaef9ba3d3c5a796eb01a5",()=>k,"4034125df2cbdc005c8af2030decfdd3f9c1030b38",()=>s,"406ac2ac175b3d146fe1ff4c98a98f6f06817b4a46",()=>i,"40a6297af27422d4551288b5192f26872415ba489b",()=>u,"40ee2ba9059aa813d068939e092131fc7754826348",()=>q,"6009307487f0bcc002ea2a06712ef0cf5b14151857",()=>j,"60a83923fc2a86194187f0e847e5fddd3c120dcc97",()=>r,"780ee3cc288d83043e5027befdbb35280be76f20f0",()=>n,"7c6dc3d93bd39156d689187aa772474e629cd3f5e5",()=>v],90376)}];

//# sourceMappingURL=_3c8a7238._.js.map